<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Payment Page</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/payments.css') }}">
</head>
<body>
  <div class="payment-wrapper">
  <h2 class="payment-title">Select Payment Method</h2>

  <!-- Payment Options List -->
  <div class="payment-options-list">
    <!-- Card -->
    <label class="payment-option">
      <input type="radio" name="payment-method" value="card" checked>
      <div class="option-content">
        <div class="option-left">
          <span class="icon">ðŸ’³</span>
          <span class="option-text">Card</span>
        </div>
        <div class="option-right">
          <img src="/static/images/logo/Payment_icons/visa.png" alt="Visa">
          <img src="/static/images/logo/Payment_icons/mastercard.png" alt="MasterCard">
          <img src="/static/images/logo/Payment_icons/rupay.png" alt="RuPay">
        </div>
      </div>
    </label>

    <!-- UPI -->
    <label class="payment-option">
      <input type="radio" name="payment-method" value="upi">
      <div class="option-content">
        <div class="option-left">
          <span class="icon">ðŸ“±</span>
          <span class="option-text">UPI</span>
        </div>
        <div class="option-right">
          <img src="/static/images/logo/Payment_icons/gpay.png" alt="GPay">
          <img src="/static/images/logo/Payment_icons/amazonpay.png" alt="Amazon Pay">
          <img src="/static/images/logo/Payment_icons/paytm.png" alt="Paytm">
        </div>
      </div>
    </label>

    <!-- Cash -->
    <label class="payment-option">
      <input type="radio" name="payment-method" value="cash">
      <div class="option-content">
        <div class="option-left">
          <span class="icon">ðŸ’µ</span>
          <span class="option-text">Cash</span>
        </div>
        <div class="option-right">
          <span>Pay at Counter</span>
        </div>
      </div>
    </label>
  </div>

  <!-- Dynamic Form Sections -->
  <div id="payment-details">
    <!-- Card Form -->
    <form id="card-form" class="payment-form" action="{{ url_for('confirm_booking') }}" method="POST">
      <input type="hidden" name="payment_method" value="card">
      <input type="hidden" name="car_id" value="{{ request.form.get('car_id') }}">
      <input type="hidden" name="start_date" value="{{ request.form.get('start_date') }}">
      <input type="hidden" name="end_date" value="{{ request.form.get('end_date') }}">
      <div class="form-group">
        <label>Cardholder Name</label>
        <input type="text" placeholder="Enter Name" required>
      </div>
      <div class="form-group">
        <label>Card Number</label>
        <input type="password" maxlength="16" placeholder="**** **** **** ****" required>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="expiry">Expiry Date</label>
          <input type="text" id="expiry" maxlength="5" placeholder="MM/YY" required>
        </div>
        <div class="form-group">
          <label>CVV</label>
          <input type="password" maxlength="3" placeholder="***" required>
        </div>
      </div>
      <button class="pay-button">Pay Now</button>
    </form>

    <!-- UPI Form -->
    <form id="upi-form" class="payment-form" style="display:none;" action="{{ url_for('confirm_booking') }}" method="POST">
      <input type="hidden" name="payment_method" value="upi">
      <input type="hidden" name="car_id" value="{{ request.form.get('car_id') }}">
      <input type="hidden" name="start_date" value="{{ request.form.get('start_date') }}">
      <input type="hidden" name="end_date" value="{{ request.form.get('end_date') }}">
      <div class="form-group">
        <label>UPI ID</label>
        <input type="text" id="upi-id" name="upi_id" placeholder="example@upi" required>
        <span id="upi-error" style="color: red; display: none;">UPI ID must contain @ symbol</span>
      </div>
      <button class="pay-button" id="upi-submit">Pay Now</button>
    </form>

    <!-- Cash -->
    <form id="cash-form" class="payment-form" style="display:none; text-align: center;" action="{{ url_for('confirm_booking') }}" method="POST">
      <input type="hidden" name="payment_method" value="cash">
      <input type="hidden" name="car_id" value="{{ request.form.get('car_id') }}">
      <input type="hidden" name="start_date" value="{{ request.form.get('start_date') }}">
      <input type="hidden" name="end_date" value="{{ request.form.get('end_date') }}">
      <p>You can pay with cash at the counter during vehicle handover.</p>
      <button class="pay-button">Confirm Booking</button>
    </form>
  </div>
</div>

<script>
    const paymentOptions = document.querySelectorAll('input[name="payment-method"]');
    const cardForm = document.getElementById('card-form');
    const upiForm = document.getElementById('upi-form');
    const cashForm = document.getElementById('cash-form');

    paymentOptions.forEach(option => {
      option.addEventListener('change', function() {
        cardForm.style.display = this.value === 'card' ? 'block' : 'none';
        upiForm.style.display = this.value === 'upi' ? 'block' : 'none';
        cashForm.style.display = this.value === 'cash' ? 'block' : 'none';
      });
    });
    document.addEventListener("DOMContentLoaded", function () {
  const expiryInput = document.getElementById("expiry");

  expiryInput.addEventListener("input", function (e) {
    let value = e.target.value.replace(/\D/g, ""); // only digits

    // Auto-insert slash after MM
    if (value.length >= 3) {
      value = value.substring(0, 2) + "/" + value.substring(2, 4);
    }

    // Limit length to 5 (MM/YY)
    value = value.substring(0, 5);
    e.target.value = value;

    // Check month validity
    if (value.length >= 2) {
      let month = parseInt(value.substring(0, 2), 10);
      if (month < 1 || month > 12) {
        e.target.style.borderColor = "red";   // highlight error
      } else {
        e.target.style.borderColor = "";      // reset if valid
      }
    }
  });

  // UPI ID validation
  const upiIdInput = document.getElementById('upi-id');
  const upiError = document.getElementById('upi-error');
  const upiSubmit = document.getElementById('upi-submit');

  upiIdInput.addEventListener('input', function() {
    if (this.value === '') {
      // Return to normal state when empty
      upiError.style.display = 'none';
      upiSubmit.disabled = false;
      this.style.borderColor = '';
    } else if (this.value.includes('@')) {
      // Valid UPI ID with @ symbol
      upiError.style.display = 'none';
      upiSubmit.disabled = false;
      this.style.borderColor = '';
    } else {
      // Invalid UPI ID without @ symbol
      upiError.style.display = 'block';
      upiSubmit.disabled = true;
      this.style.borderColor = 'red';
    }
  });

  // Validate on form submission
  upiForm.addEventListener('submit', function(e) {
    if (!upiIdInput.value.includes('@')) {
      e.preventDefault();
      upiError.style.display = 'block';
      upiIdInput.style.borderColor = 'red';
    }
  });
});
</script>
</body>
</html>
